NOT FINISHED

* DPR — Data Processing and Rendering (Обработка и отображение данных) - процесс, при котором данные (например, JSON) обрабатываются на серверной стороне (например, с помощью Django) и затем передаются в представление для рендеринга на клиентской стороне с использованием шаблонов и JavaScript
* нет ясности в том, как же между собой взаимодействовать частям приложения
  + нет четкого контракта между фронт/бэк частями
  + Отсюда неясности и с моделями в джанге: какие данные в ней нужны и как их обрабатывать и отдавать
* в модели пользователя я сохраняю аватарки
  + у фронт энда есть требования какие нибудь к аватаркам или они могут сами отрисовывать?
  + вдруг пользователь сохранит свою фотографию 1000 х 1000 пикселей, на фронте вы сможете сами отрисовать аватарку ?
* трекинг когда пользователь был онлайн
  + в models.py добавлю last online - просто для индикатива
  + есть три ключевых решения 
    - через Django sessions - как только юзер делает какое либо действие, Джанго сохраняет в базу данных дату этого действия 
    - через библиотеку channels - по вебсокетам следим пользователь онлайн или нет 
    - через redis - но не понял как это работает. 
* с точки зрения реализации api есть class based views / functions based views
  + fbv проще
  + cbv не сильно сложнее.
* используем ли мы стандартную модель пользователя с кастомизацией или используем свою модель
  + от этого зависит будущая авторизация и как авторизация / permissions будут работать
  + Если стандартную модель - надо перезагрузить все примененные миграции и таблички
* Используем стандартные структуры юзера для авторизации и для моделей данных
* Шаблон = супер базовый html файл с полями кнопками, без разметки
* вы должны предупредить клиента, что его ждет игра, даже если он в чате
* Redis (Remote Dictionary Server) — инструмент управления данными
  + in-memory key-value store
  + для реализации временных и динамических данных
  + может использоваться как база данных, кэш или брокер сообщений
  + значения могут быть: string, list, hash, set, sorted sets, bitmap, HyperLogLogs, геопространственные индексы и др  
  + высокая скорость, низкие задержки, простой интерфейс
  + полностью работает в оперативной памяти, что обеспечивает высокую скорость
    - может сохранять данные на диск, чтобы избежать потери при сбоях
  + Поддержка Pub/Sub (механизм публикации/подписки) для обмена сообщениями
  + Возможности кэширования с гибким управлением временем жизни данных (TTL)
  + Транзакции и скрипты на языке Lua
  + Репликация и кластеризация для масштабирования и высокой доступности
  + поддерживает множество языков программирования
  + Примеры использования:
    - Кэширование данных: Хранение временных данных для ускорения работы приложений
    - Сессии: Управление пользовательскими сессиями в веб-приложениях
    - Очереди сообщений: Использование механизма списков или Pub/Sub для реализации очередей
    - Лидеры и рейтинги: Упорядоченные множества используются для хранения рейтингов в реальном времени
    - Анализ данных: Быстрый подсчёт статистики, временных данных
    - для хранения часто запрашиваемых данных, чтобы не обращаться каждый раз к основной базе (Хранение информации о пользователях (имя, аватар, статус) для быстрого доступа. Кэширование результатов сложных SQL-запросов.)
    - Реализация чата (Совместно с WebSocket для быстрой обработки сообщений. В Pub/Sub позволяет рассылать сообщения всем пользователям чата.)
    - для хранения данных сессий, потому что он работает в оперативной памяти и обеспечивает быструю запись и чтение. (Хранение данных о текущих авторизованных пользователях. Управление сессиями при подключении пользователей к WebSocket.)
    - может работать как очередь задач (Очередь отправки email, push-уведомления. Логирование или обработка фоновых задач (например, обновление статистики матчей))
    - позволяет задавать время жизни (TTL) для хранимых данных, что делает его полезным для временных данных. (Ограничение количества запросов от одного пользователя за определённое время (rate limiting). Хранение временного статуса пользователя: онлайн/офлайн.)
    - для матчей в реальном времени (Хранение текущего состояния игры. Обмен данными между игроками. Хранение лидербордов с помощью упорядоченных множеств (sorted sets))
* валидация данных
  + js на фронте читает инпут, проверяет с помощью regex
  + функция make password django шифрует на сервере ?
  + бэк ещё раз валидирует (например, проверяет пароль и почту) 

### index.html
* `{% extends "base.html" %}` расширение базового шаблона
  + Шаблон наследует структуру из базового файла base.html
  + всё из ({% block body %}) будет вставлено в base.html на место тега `{% block body %}`
*  ```
   <div class="container mt-5">                              // контейнер с отступом сверху
    <h1 class="text-center">Привет из Django!</h1>
    <p class="text-center">База данных: {{ db_version }}</p> // Шаблонная переменная {{ db_version }}, значение передаётся в шаблон из представления Django (view)
   </div>
   ```
* `<a href="#" class="btn btn-primary">Нажми меня</a>`  Класс btn btn-primary задаёт стиль кнопки
* ```
  {% if user.is_authenticated %}                             // Шаблонное условие
    <p>Пользователь: <strong>{{ user.username }}</strong> (авторизован)</p> // user - Стандартная переменная, доступная в шаблоне, содержащая информацию о текущем пользователе
  {% else %}
    <p>Вы не авторизованы. Пожалуйста, <a href="/login/">войдите</a> в систему.</p>
  {% endif %}
  ```
* Карточка Bootstrap  

### некоторые файлы
* backend/wenhook/views.py
  + реализация вебхука GitHub в Django, для автоматического обновления кода и перестройки контейнеров при определённых событиях, таких как push в ветку main

### Chat
* можно ли делать live chat (с библиотекой channels) или надо целиком писать
  + Какие библиотеки можно использовать?
* Django Channels - библиотека для чата
  + библиотека для вебсокетов
  + подходит для создания чатов, так как WebSocket позволяет передавать данные между сервером и клиентом в режиме реального времени (обмен сообщениями, уведомления)
  + для реализации приложений с функциями реального времени, выходящих за рамки стандартного HTTP-протокола  
  + надстройка для Django 
    - добавляет поддержку протоколов, отличных от HTTP, таких как WebSocket
  + Channel в принципе за WS. На нем же и онлайн игру сделать можно
  + может быть использован для других приложений в реальном времени
    - Онлайн-игры: WebSocket обеспечивает постоянное соединение между клиентом и сервером, что важно для передачи игровых данных в реальном времени
    - Трекинг пользователей в режиме реального времени (отображение онлайн-статуса пользователей)
* RabbitMQ будет использоваться как брокер сообщений, но это больше системные сообщения
  + уведомление о начале турнира, уведомление о добавлении в друзья
* Channels library / RabbitMQ - обсудить водораздел между ними, нужны ли оба
* чат в формате поп-ап окна сбоку
* Do you have a database?
  + If not, you need to set up the database: `python manage.py makemigrations`, `python manage.py migrate`
  + create a superuser `python manage.py createsuperuser`
  + reload the server in Docker
* we implement game logic in backed, backend because we need it to do the multiplayer

### Autorisation
* виды авторизаций: Ecole 42, гугл, логин и пароль с базы данных пользователя
* задача на бэкэнде
* не совсем четкое разделение роли
* Л. придется разбираться с нюансами DRF и с фронтом
* Для аутентификации вы можно асимметричный алгоритм (например RSA)
  + служба аутентификации — единственная, которая хранит закрытый ключ и может выдавать токены
  + Токены содержат имя пользователя, которого они идентифицируют
  + другие микросервисы могут проверять их с помощью открытого ключа и могут доверять данному имени пользователя, если подпись проверена
  + Самый простой и самый безопасный — использовать файлы cookie
    - Поскольку все микросервисы имеют одно и то же имя хоста, файл cookie будет автоматически отправляться браузером при каждом запросе
    - Со стороны DRF у вас есть расширение для JWT, но мне не удалось заставить его работать с RSA, было проще создать собственное промежуточное программное обеспечение для аутентификации
  + https://dzone.com/articles/using-jwt-in-a-microservice-architecture
* настройка микросервисной архитектуры - планировали использовать JWT в серверной службе DRF
  + удалось добавить несколько токенов, следуя официальной документации
  + возникли трудности с вложением их в nginx сервер, который служит API-шлюзом/обратным прокси-сервером
  + есть ли документация по реализации службы аутентификации как части микросервисной архитектуры?
  + https://django-rest-framework-simplejwt.readthedocs.io/en/latest/getting_started.html
  + https://openclassrooms.com/fr/courses/7192416-mise-en-place-une-api-avec-django-rest-framework/7424720-give-access-with-the-tokens
 + nginx должен быть полностью прозрачным в управлении jtwt
   - он ничего не делает, кроме пересылки запросов
   - где его хранить jwt, мы решили сделать это наиболее безопасным способом, не сохраняя его в файле cookie, а в локальном хранилище (только в переменной в js, и мы обновляем как как только он истечет)
* внедрить 2FA через электронную почту
  + Мы выполнили первую часть, генерируя код и все такое
  + были проблемы с последней частью, где мы на самом деле отправляем электронное письмо
    - попробовали sendgrid life, но, не тратя никаких денег, было сложно добиться успеха в отправке электронных писем
  + мы использовали Gmail, самое сложное — найти путь через пользовательский интерфейс Google для создания «mdp приложения» на стороне Django, все легко делается с помощью функции send_mail, документированной по памяти
    - Сначала это пришло как спам, а потом появилось само по себе после нескольких писем
  + Да, со стороны Django это происходит, Gmail они изменили свои условия примерно две недели назад, и с тех пор, насколько я понял, это стало проблемой
* CSRF (Cross-Site Request Forgery) token
  + в рамках авторизации делать, и видимо при post / get запросах?
  + лучше использовать JWT и тогда не будет необходимости в поименении CSRF-токена
  + CSRF token нужно будет реализовывать Л.
  + Его не нужно «реализовывать», он прописан в settings.py проекта. Его нужно отдать клиенту при первом запросе, а потом клиент будет слать запросы к api и вставлять этот токен в запрос. Я бы таки смотрел в сторону JWT.
  + во views.py есть набор проверок которые нужно добавить при запросе к api
  + со стороны Л. - остальная часть в части обмена этим токеном при авторизации
* у меня ошибка 403 на REST API. Я видел в Интернете, что вам нужно использовать токен csrft
  + https://docs.djangoproject.com/en/5.1/howto/csrf/ использование CSRF с Django, Документ Django по всем вопросам аутентификации и даже глобального использования действительно очень понятен и хорошо объяснен.

###  Organisation
* https://miro.com/app/board/uXjVLAphyh8=/
* https://docs.google.com/document/d/1O1r9jEdxISjMV29lZgLXWNh-bgPzSlnZ6Nr8QuyP_Jc/edit?pli=1
* У нас на всю линейку продуктов от JetBrains бесплатная студенческая лицензия
  + для фронта WebStorm
* git
  + создать dev ветку и работать с ней, потом смерджить в main
  + в dev-ветке создавать суб-ветки под каждую фичу или фикс
    - git checkput -b feature/backend/add_user_model
    - в этой ветке работать именно над конкретной задачей и оформлять в пул реквест.
  + не пушить код большими и хаотичными кусками
  + we do not "git push" directly to main branch - only push to your own branch and after check (we have no tests so it is just double check from your side) - merge your branch with main branch
  + https://befitting-chili-056.notion.site/Branch-management-171a80978370805f8faedeadcb86e35d?pvs=4 
* the password for the django admin panel ...
* the docker extension in vscode
  + you can launch bash inside a container from gui
* web sockets
  + Django Channels стандартное средство реализации веб-сокетов на базе Django
  + не запрещено в сабжекте
  + реализация собственного асинхронного слоя может быть проблемой
* frontend:
  + Bootstrap toolkit
  + игра сама, картинка
  + assessibility
  + multiple language

### запуск проекта
* в гитигнор добавить 'backend/.env', '.env42'
* https://tr.naurzalinov.me/users/
* http://95.217.129.132:8000/chat/1
  + Секретный ключ от api раз в две недели примерно обновляется
* https://localhost
* 'docker compose up --build'
  - все скачается и распакуется
  - потом в терминале можно Ctrl + C (условное клавиатурное прерывание)
* `sudo ufw status` убедитесь, что 80, 443, и 8000 открыты
* https://localhost:8000 проверка бэкенда
  + 502 Bad Gateway = Nginx не смог подключиться к бэкенду или получил от него некорректный ответ
* `curl http://localhost:8000`
* `docker exec -it git-backend-1 ss -tuln` проверить порты бэкенда
  + `tcp LISTEN 0 511 0.0.0.0:8000 0.0.0.0:*`
* `docker exec -it git-frontend-1 curl http://git-backend-1:8000` подключиться к бэкенду из контейнера
* `docker logs git-backend-1`
* `docker logs git-frontend-1`
* конфигурация Nginx
  + proxy_pass указывает на git-backend-1 и 8000
* заставить работать соединение через 42 на посте кластера, отличном от того, на котором он размещен
  + один способ: каждый раз менять URL-адрес перенаправления, чтобы он соответствовал IP-адресу хост-компьютера 
  + лучшее решение, позволяющее избежать хлопот, особенно с учетом ограничений школьных компьютеров: пройти через виртуальную машину и каждый компьютер использует виртуальную машину, и в ней вы изменяете файл хостов, чтобы связать IP-адрес исходной станции с URL-адресами в бизнесе/проде у вас есть доменные имена, так или иначе связанные, так что это не проблема в вашей голове но я думаю, что вы можете подключиться к другому компьютеру в кластере через его внутреннее доменное имя школы соответствующее тому же названию должности, которую вы используете в штатном расписании но вам придется добавить это в свою конфигурацию nginx, чтобы ваш веб-сервер разрешал связываться с вами в этом домене, а также на стороне django
* в школе
  + порт, который нужен для django, занят
  + поменять номера портов в docker и в nginx

### Tutorials
* как работает бэк, фронт-энд, база данных, зачем API https://www.youtube.com/watch?v=XBu54nfzxAQ
* созданиe REST API на DRF в Pycharm https://blog.jetbrains.com/pycharm/2023/09/building-apis-with-django-rest-framework/
* как работает бэк, фронт, база данных, зачем API https://www.youtube.com/watch?v=XBu54nfzxAQ 
* бэкенд
  + Django Tutorial https://developer.mozilla.org/en-US/docs/Learn/Server-side/Django/Tutorial_local_library_website
  + https://www.djangoproject.com/start/
  + https://www.django-rest-framework.org/tutorial/quickstart/
  + django https://youtube.com/playlist?list=PLA0M1Bcd0w8xZA3Kl1fYmOH_MfLpiYMRs&si=mza4MvfFeRMqgU_B
  + django https://youtube.com/playlist?list=PLA0M1Bcd0w8yU5h2vwZ4LO7h1xt8COUXl&si=ddHMMDnBVPiUuEXy
  + The Browsable API - Django REST frameworkhttps://www.django-rest-framework.org/topics/browsable-api/
* https://docs.djangoproject.com/en/5.1/ref/contrib/auth/

### My questions
* settings.py SECRET_KEY

### to to
* pop-up windows : login, chat, profile
* страница comptetition, profile, найтройки
* single-page: один html
  + этот html меняется с помощью js
  + не надо: server side rendering подход
  + не надо: django html - server-side code
  + не надо: в завимисости от какого-то условия, показываем или нет какие-то части страницы
  + надо: js
  + надо: код внутри {} исполняется в django, если условие выполняется (например, есть есть юзер), он выполняет и заново отправляет html
* написовать стол, чтобы реагировал на клавиатуру и мышку
  + потом туда подсоединим вебсокеты, базовый дизайн
* Б
  + структуры данных
  + Django REST Framework
  + модуль с сокетами и чатом (live chat, уведомления о турнирах, и проч)
  + API, эндпоинты и методы для API
  + live chat
  + rabbitMQ модуль сообщение от сервера
* Л
  + авторизация
  + фронт-энд
  + шаблон для фронт энда
* Ан
  + фронт-энд
  + накидать в Figma шаблоны страничек (часть есть в Миро) страницы следующие - страница с логином, страница с самой игрой (пока без игры), страница с профилем самого пользователя, страница с турниром
  + писать код, делать шаблончики  
  + сайт должен быть одностраничный, один html файл
  + обсудить с Л. структуры страничек, API с бэкэнда
  + помощь на фронт энд, точечные задания 
* К
  + помощь на фронт энд, точечные задания 
* Амин
  + вебсокеты для модуля remote players
    - обмен информацией между игроками и сервером о локации ракетки и мяча
  + логика игры 
